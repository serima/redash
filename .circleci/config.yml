version: 2
jobs:
  build:
    docker:
      - image: circleci/node:6
      - image: redis:3.0
    working_directory: ~/redash
    steps:
      - checkout
      - run: sudo apt install python-pip python-dev -y
      - run: sudo pip install --upgrade setuptools
      - run: sudo pip install -r requirements_dev.txt
      - run: sudo pip install -r requirements.txt
      - run: make deps
      - run: nosetests --with-xunit --xunit-file=/tmp/junit/junit.xml --with-coverage --cover-package=redash tests/
